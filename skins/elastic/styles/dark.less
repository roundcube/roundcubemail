/**
 * Roundcube webmail styles for the Elastic skin
 *
 * Copyright (c) 2017-2018, The Roundcube Dev Team
 *
 * The contents are subject to the Creative Commons Attribution-ShareAlike
 * License. It is allowed to copy, distribute, transmit and to adapt the work
 * by keeping credits to the original authors in the README.md file.
 * See http://creativecommons.org/licenses/by-sa/3.0/ for details.
 */

& when (@dark-mode-enabled = true) {
    @media (prefers-color-scheme: dark) {
        body {
            color: @color-dark-font;
            background-color: @color-dark-layout-content-background;
        }

        a {
            color: @color-dark-link;

            &:hover {
                color: @color-dark-link-hover;
            }
        }

        .form-control {
            background-color: @color-dark-input-background;

            &:focus {
                background-color: @color-dark-input-background-focus;
            }
        }

        .popover {
            background-color: @color-dark-popover-background;
        }

        .popover-body {
            color: @color-dark-font;
        }

        .bs-popover-auto[x-placement^="right"] > .arrow::after,
        .bs-popover-right > .arrow::after {
            border-right-color: @color-dark-popover-background;
        }

        .bs-popover-auto[x-placement^="left"] > .arrow::after,
        .bs-popover-left > .arrow::after {
            border-left-color: @color-dark-popover-background;
        }

        .bs-popover-auto[x-placement^="top"] > .arrow::after,
        .bs-popover-top > .arrow::after {
            border-top-color: @color-dark-popover-background;
        }

        .bs-popover-auto[x-placement^="bottom"] > .arrow::after,
        .bs-popover-bottom > .arrow::after {
            border-bottom-color: @color-dark-popover-background;
        }

        .ui-widget-header {
            background-color: @color-dark-dialog-header-background !important;
        }

        .ui-widget-content {
            background-color: @color-dark-dialog-content-background !important;
        }

        body > #layout {
            & > div {
                &.sidebar,
                &.list {
                    border-right-color: @color-dark-layout-border;
                }

                &.content {
                    background-color: @color-dark-layout-content-background;
                }

                &.sidebar {
                    background-color: @color-dark-layout-sidebar-background;
                }

                &.list {
                    background-color: @color-dark-layout-list-background;
                }

                & > .header,
                & > .footer {
                    background-color: @color-dark-layout-header-background;
                }

                & > .header {
                    border-bottom-color: @color-dark-layout-border;
                    color: @color-dark-layout-header;
                }

                & > .footer {
                    border-top-color: @color-dark-layout-border;
                    background-color: @color-dark-layout-footer-background;
                }
            }
        }

        @media screen and (max-width: @screen-width-small) {
            body > #layout > div > .header {
                background-color: @color-dark-layout-mobile-header-background;
            }

            body > #layout > div > .footer {
                background-color: @color-dark-layout-mobile-footer-background;
            }
        }

        @media screen and (min-width: (@screen-width-xs + 1px)) {
            body > #layout > .menu {
                // FIXME: we set background color here not in taskmenu.less, because
                // otherwise background is partially white on Android/iOS
                background-color: @color-dark-taskmenu-background;
            }
        }

        #rcmdraglayer {
            background-color: @color-dark-drag-layer-background;
            color: @color-dark-drag-layer;
            box-shadow: 3px 3px 5px @color-dark-drag-layer-shadow;
        }

        .listbox {
            .popup & {
                .footer {
                    border-top-color: @color-dark-layout-border;
                    background-color: @color-dark-searchbar-background;
                }
            }
        }

        // this is when image thumbnails are enabled
        p.image-attachment {
            border-color: @color-dark-border;
            background-color: @color-dark-message-background;

            span {
                color: @color-dark-form-hint;
            }
        }

        // this is when image thumbnails are disabled
        fieldset.image-attachment {
            legend {
                color: @color-dark-form-hint;
                border-top-color: lighten(@color-dark-mail-headers, 50%);
            }
        }

        .iframe-loader {
            .spinner-border {
                color: @color-dark-spinner-circle;
                border-color: currentColor @color-dark-spinner-item currentColor currentColor;
            }
        }

        .webkit-scroller {
            &::-webkit-scrollbar-thumb {
                border-color: #fff;
            }
        }

        .quota-widget {
            color: @color-dark-quota-text;

            .count {
                color: @color-dark-quota-text;
            }

            .bar {
                background-color: @color-dark-quota-background;
                border-color: @color-dark-layout-border;
            }

            .value {
                background-color: @color-dark-quota-value;

                &.warning {
                    background-color: @color-dark-quota-value-warning;
                }
            }
        }

        .quota-info {
            .root {
                color: @color-dark-popover-separator;
                background-color: @color-dark-popover-separator-background;
            }
        }

        .table-widget {
            border-color: @color-dark-table-border;

            & > .footer {
                border-top-color: @color-dark-table-border;
            }

            // Options table is a table with first column for identifier/description
            // and other columns for a state flag. E.g. ACL table
            table.options-table {
                tr:last-child td {
                    border-bottom-color: @color-dark-table-border;
                }

                tr.selected td {
                    background-color: @color-dark-table-selected-background;
                    color: @color-dark-table-selected;
                }
            }
        }

        .floating-action-buttons {
            a.button {
                background: @color-dark-main;
                box-shadow: 0 0 5px 5px darken(@color-dark-main, 35%);
            }
        }

        /*** Bootstrap button style overrides ***/

        .btn {
            &:focus {
                box-shadow: 0 0 0 .2rem fade(@color-dark-btn-primary-background, 30%);
            }
        }

        .btn-secondary {
            color: @color-dark-btn-secondary;
            background: @color-dark-btn-secondary-background;
            border-color: @color-dark-btn-secondary-background;

            &:focus {
                box-shadow: 0 0 0 .2rem fade(@color-dark-btn-secondary-background, 50%);
            }

            &:hover {
                background: darken(@color-dark-btn-secondary-background, 5%);
                border-color: darken(@color-dark-btn-secondary-background, 7%);
            }

            &.disabled,
            &:disabled {
                background: lighten(@color-dark-btn-secondary-background, 20%);
                border-color: lighten(@color-dark-btn-secondary-background, 20%);
                opacity: 1;
            }

            &:not(:disabled):not(.disabled) {
                &:active,
                &.active {
                    background: darken(@color-dark-btn-secondary-background, 10%);
                    border-color: darken(@color-dark-btn-secondary-background, 12%);

                    &:focus {
                        box-shadow: 0 0 0 .2rem fade(@color-dark-btn-secondary-background, 53%);
                    }
                }
            }
        }

        .btn-primary {
            color: @color-dark-btn-primary;
            background: @color-dark-btn-primary-background;
            border-color: @color-dark-btn-primary-background;

            &:focus {
                box-shadow: 0 0 0 .2rem fade(@color-dark-btn-primary-background, 50%);
            }

            &:hover {
                background: darken(@color-dark-btn-primary-background, 5%);
                border-color: darken(@color-dark-btn-primary-background, 7%);
            }

            &.disabled,
            &:disabled {
                background: lighten(@color-dark-btn-primary-background, 20%);
                border-color: lighten(@color-dark-btn-primary-background, 20%);
            }

            &:not(:disabled):not(.disabled) {
                &:active,
                &.active {
                    background: darken(@color-dark-btn-primary-background, 10%);
                    border-color: darken(@color-dark-btn-primary-background, 12%);

                    &:focus {
                        box-shadow: 0 0 0 .2rem fade(@color-dark-btn-primary-background, 53%);
                    }
                }
            }
        }

        .btn-danger {
            color: @color-dark-btn-danger;
            background: @color-dark-btn-danger-background;
            border-color: @color-dark-btn-danger-background;

            &:focus {
                box-shadow: 0 0 0 .2rem fade(@color-dark-btn-danger-background, 50%);
            }

            &:hover {
                background: darken(@color-dark-btn-danger-background, 5%);
                border-color: darken(@color-dark-btn-danger-background, 7%);
            }

            &.disabled,
            &:disabled {
                background: lighten(@color-dark-btn-danger-background, 20%);
                border-color: lighten(@color-dark-btn-danger-background, 20%);
            }

            &:not(:disabled):not(.disabled) {
                &:active,
                &.active {
                    background: darken(@color-dark-btn-danger-background, 10%);
                    border-color: darken(@color-dark-btn-danger-background, 12%);

                    &:focus {
                        box-shadow: 0 0 0 .2rem fade(@color-dark-btn-danger-background, 53%);
                    }
                }
            }
        }

        /*** jQuery-UI widgets' style overrides ***/

        .ui-widget-overlay {
            background-color: @color-dark-dialog-overlay-background;
        }

        .ui-widget {
            border-color: @color-dark-datepicker-border;
            box-shadow: 3px 3px 5px @color-dark-popover-shadow;
        }

        .ui-menu {
           .ui-state-active {
                background-color: @color-dark-toolbarmenu-hover-background !important;
            }
        }

        .ui-dialog {
            .ui-dialog-titlebar {
                border-bottom-color: @color-dark-dialog-header-border;
            }

            .ui-dialog-title {
                color: @color-dark-dialog-header;
            }

            .ui-dialog-titlebar-close {
                color: @color-dark-dialog-header;
            }

            .ui-dialog-buttonpane {
                .ui-dialog-buttonset {
                    a.btn-link {
                        color: @color-dark-font;

                        &:focus {
                            background-color: fade(@color-dark-btn-primary-background, 50%);
                        }
                    }
                }
            }
        }

        @media screen and (max-width: @screen-width-xs) {
            .ui-dialog {
                .ui-dialog-titlebar {
                    background-color: @color-dark-layout-mobile-header-background;
                }

                .ui-dialog-buttonpane {
                    border-top-color: @color-dark-dialog-header-border;
                    background-color: @color-dark-layout-mobile-footer-background;

                    .ui-dialog-buttonset {
                        button {
                            &.btn-primary,
                            &.btn-secondary {
                                color: @color-dark-toolbar-button;
                            }

                            &.btn-danger {
                                color: @color-dark-btn-danger-background;
                            }
                        }

                        a.btn-link {
                            color: @color-dark-toolbar-button;
                        }
                    }
                }
            }
        }

        /* Slider widget */

        .ui-slider {
            .ui-slider-range {
                background: lighten(@color-dark-main, 30%);
            }

            .ui-slider-handle {
                &.ui-state-active {
                    background: @color-dark-main;
                    border-color: @color-dark-main-dark;
                }
            }
        }

        /* Datepicker widget */

        .ui-datepicker {
            .ui-datepicker-header {
                border-bottom-color: @color-dark-dialog-header-border;
            }

            .ui-state-default,
            &.ui-widget-content .ui-state-default {
                color: @color-dark-datepicker-font;
            }

            .ui-datepicker-days-cell-over a,
            .ui-datepicker-days-cell-over a.ui-state-default,
            .ui-state-highlight,
            &.ui-widget-content .ui-state-highlight {
                background: @color-dark-datepicker-highlight-background;
                color: @color-dark-datepicker-highlight;
            }

            a.ui-state-active {
                background: @color-dark-datepicker-active-background !important;
                color: @color-dark-datepicker-active !important;
            }
        }

        .minicolors-panel {
            border-color: @color-dark-datepicker-border;
            box-shadow: 3px 3px 5px @color-dark-popover-shadow;
        }

        .popover {
            box-shadow: 3px 3px 5px @color-dark-popover-shadow;
            border-color: @color-dark-layout-border;
        }

        #rcmKSearchpane {
            html.layout-small &,
            html.layout-phone & {
                border-color: @color-dark-input-border;
            }
        }

        html.layout-small,
        html.layout-phone {
            .popover:not(.select-menu) {
                .listing li:last-child {
                    border-bottom-color: @color-dark-list-border;
                }
            }

            .popover-overlay {
                background-color: @color-dark-dialog-overlay-background;
            }

            .popover-header {
                color: @color-dark-popover-mobile-header;
                background-color: @color-dark-popover-mobile-header-background;
            }
        }

        /** PGP Key search/import dialog **/

        .pgpkeyimport {
            div.key {
                &.revoked,
                &.disabled {
                    color: @color-dark-list-secondary;
                }
            }
        }

        #taskmenu {
            @media screen and (max-width: @screen-width-xs) {
                a {
                    border-bottom-color: @color-dark-list-border;
                    color: @color-dark-list;
                }
            }

            @media screen and (min-width: (@screen-width-xs + 1px)) {
                a {
                    color: @color-dark-taskmenu-button;

                    &.selected {
                        color: @color-dark-taskmenu-button-selected;
                        background: @color-dark-taskmenu-button-selected-background;
                    }

                    &:hover {
                        color: @color-dark-taskmenu-button-hover;
                        background: @color-dark-taskmenu-button-background-hover;
                    }
                }

                .special-buttons {
                    background-color: @color-dark-taskmenu-background;
                }

                .action-buttons {
                    a {
                        color: @color-dark-taskmenu-button-action;
                        background: @color-dark-taskmenu-button-action-background;

                        &:hover {
                            color: @color-dark-taskmenu-button-action-hover;
                            background: @color-dark-taskmenu-button-action-background-hover;
                        }

                        &.selected {
                            background: @color-dark-taskmenu-button-selected-background;
                        }
                    }
                }

                a.logout {
                    color: @color-dark-taskmenu-button-logout-hover !important;
                }
            }
        }

        .menu {
            .popover-header {
                @media screen and (min-width: (@screen-width-xs + 1px)) {
                    background-color: @color-dark-taskmenu-background !important;
                }
            }
        }

        .ui.alert {
            color: @color-dark-message;
            border-color: @color-dark-message-border;
            background-color: @color-dark-message-background;

            & > i.icon {
                color: lighten(@color-dark-black, 25%);
            }

            &.loading {
                color: @color-dark-message-loading;
            }

            &.alert-success > i.icon:before {
                color: @color-dark-message-success;
            }

            &.alert-warning > i.icon:before {
                color: @color-dark-message-warning;
            }

            &.alert-danger > i.icon:before {
                color: @color-dark-message-error;
            }

            a:not(.btn) {
                color: @color-dark-message-link;
                font-weight: @color-dark-message-link-font-weight;
            }

            &.boxerror {
                background-color: @color-dark-message-error-box-background;
                & when not(@color-dark-message-error-box = @color-dark-message) { color: @color-dark-message-error-box; }
            }

            &.boxinformation {
                background-color: @color-dark-message-information-box-background;
                & when not(@color-dark-message-information-box = @color-dark-message) { color: @color-dark-message-information-box; }
            }

            &.boxconfirmation {
                background-color: @color-dark-message-success-box-background;
                & when not(@color-dark-message-error-box = @color-dark-message) { color: @color-dark-message-error-box; }
            }

            &.boxwarning {
                background-color: @color-dark-message-warning-box-background;
                & when not(@color-dark-message-warning-box = @color-dark-message) { color: @color-dark-message-warning-box; }
            }
        }

        #messagestack {
            div {
                background-color: @color-dark-message;
                color: #fff;

                & > i.icon:before {
                    color: #fff;
                }
            }

            .loading {
                background-color: @color-dark-message-loading;
            }

            .alert-info.information {
                background-color: @color-dark-message-information;
            }

            .alert-success {
                background-color: @color-dark-message-success;
            }

            .alert-warning {
                background-color: @color-dark-message-warning;
            }

            .alert-danger {
                background-color: @color-dark-message-error;
            }
        }

        .toolbar {
            &.listing a,
            a {
                color: @color-dark-toolbar-button;
            }

            a.button {
                &.selected {
                    color: @color-dark-success;
                }
            }

            &.pagenav {
                .pagenav-text {
                    color: @color-dark-list-pagenav;
                }

                &.pagenav-list {
                    background-color: @color-dark-searchbar-background;
                    border-bottom-color: @color-dark-list-border;

                    & + .navlist {
                        background-color: #fbfbfb;
                    }

                    &.expanded + .navlist {
                        border-bottom-color: @color-dark-layout-border;
                    }
                }
            }
        }


        .header {
            a.button {
                color: @color-dark-toolbar-button;
            }

            .buttons {
                button {
                    color: @color-dark-toolbar-button;
                }
            }
        }

        .toolbarmenu li {
            &.separator {
                color: @color-dark-popover-separator;
                background-color: @color-dark-popover-separator-background;
            }
        }

        .toolbarmenu.listing li {
            &:hover {
                a.active {
                    color: @color-dark-toolbarmenu-hover;
                    background-color: @color-dark-toolbarmenu-hover-background;
                }
            }
        }

        @media screen and (min-width: (@screen-width-small + 1px)) {
            .toolbar {

                a.button {
                    &:not(.disabled):focus,
                    &:not(.disabled):hover {
                        background-color: @color-dark-toolbar-button-background-hover;
                    }
                }

                .dropbutton {
                    &:not(.disabled):hover {
                        background-color: @color-dark-toolbar-button-background-hover;
                    }

                    a.button.dropdown {
                        &:hover {
                            background-color: darken(@color-dark-toolbar-button-background-hover, 5%);
                        }
                    }
                }
            }

            .header a.button.icon {
                &:not(.disabled):focus,
                &:not(.disabled):hover {
                    background-color: @color-dark-toolbar-button-background-hover;
                }
            }
        }

        @media screen and (max-width: @screen-width-small) {
            .toolbar.listing a {
                color: @color-dark-font;
            }
        }

        .searchbar {
            background-color: @color-dark-searchbar-background;
            border-bottom-color: @color-dark-list-border;

            form {
                &:before {
                    color: @color-dark-list-pagenav;
                }

                input {
                    color: @color-dark-searchbar;
                }
            }

            a.button {
                color: @color-dark-toolbar-button;
            }
        }

        .listing {
            tbody td,
            li {
                border-bottom-color: @color-dark-list-border;
            }

            tbody td,
            li a {
                color: @color-dark-list;
            }

            tbody td {
                a {
                    color: @color-dark-list;
                }
            }

            li.selected,
            tr.selected td {
                color: @color-dark-list-selected;
                background-color: @color-dark-list-selected-background;
            }

            li.droptarget > a,
            tr.droptarget > td {
                background-color: @color-dark-list-droptarget-background;
            }

            li.disabled,
            tr.disabled td {
                color: @color-dark-list-deleted;
            }

            span.secondary {
                color: @color-dark-list-secondary;
            }
        }

        // Focus indicator
        html:not(.touch) {
            .listing {
                li > a:focus,
                &.focus tbody tr.focused > td:first-child,
                &.focus:not(.withselection) tbody tr.focused > td.selection + td {
                    border-left-color: @color-dark-list-focus-indicator;
                }
            }
        }

        ul.listing {
            li {
                ul {
                    border-top-color: @color-dark-list-border;
                }
            }
        }

        .listing-info {
            color: @color-dark-list-secondary;
        }

        @media screen and (max-width: @screen-width-large) {
            .listing.selection-large-only {
                li.selected {
                    color: @color-dark-list;
                }
            }
        }

        .popupmenu .listing {
            li.selected {
                color: @color-dark-toolbarmenu-hover;
                background-color: @color-dark-toolbarmenu-hover-background;
            }
        }

        ul.treelist {
            li {
                &.selected {
                    & > div > a, // this is used e.g. by kolab_addressbook
                    & > a {
                        color: @color-dark-list-selected;
                        background-color: @color-dark-list-selected-background;
                    }
                }
            }
        }

        .folderlist {
            li {
                &.mailbox {
                    &.recent {
                        color: @color-dark-list-recent;
                    }

                    .unreadcount {
                        background: @color-dark-list-badge-background;
                        color: @color-dark-list-badge;
                    }

                    &.recent > .unreadcount {
                        background: @color-dark-list-recent-badge-background;
                        color: @color-dark-list-recent-badge;
                    }
                }
            }
        }

        .messagelist {
            tr.unread td.subject span.subject a {
                color: @color-dark-list-unread;
            }

            td.subject {
                span {
                    &.date {
                        color: @color-dark-list-secondary;
                    }

                    &.fromto {
                        color: @color-dark-list-secondary;
                    }
                }
            }

            tr.flagged td,
            tr.flagged td.subject span.subject a,
            tr.flagged td.subject span.date,
            tr.flagged td.subject span.fromto {
                color: @color-dark-list-flagged;
            }

            tr.deleted td,
            tr.deleted td.subject span.subject a,
            tr.deleted td.subject span.date,
            tr.deleted td.subject span.fromto {
                color: @color-dark-list-deleted;
            }

            td.subject span.msgicon.status {
                &.unread:before {
                    color: @color-dark-list-unread-status;
                }
            }

            span.attachment span {
                color: @color-dark-list-icon;
            }
        }

        .contactlist {
            span.email {
                color: @color-dark-list-secondary;
            }
        }

        .attachmentslist {
            li {
                .attachment-name {
                    color: @color-dark-font;
                }

                .attachment-size {
                    color: @color-dark-list-secondary;
                }
            }
        }

        .propform {
            .form-text {
                color: @color-dark-form-hint;
            }
        }

        .formcontent {
            .hint {
                color: @color-dark-form-hint;
            }

            // RAW (CodeMirror) editor
            &.raweditor {
                .CodeMirror {
                    border-color: @color-dark-input-border;
                    color: @color-dark-font;
                }

                .CodeMirror-focused {
                    border-color: @color-dark-input-border-focus;
                    box-shadow: 0 0 0 .2rem @color-dark-input-border-focus-shadow;
                }

                .CodeMirror-linebackground.line-error {
                    background-color: @color-dark-error;
                }
            }
        }

        .input-group a {
            &:focus {
                background-color: @color-dark-input-border-focus-shadow;
            }
        }

        .multi-input {
            & > .content {
                border-color: @color-dark-input-border;
            }

            input,
            input:focus,
            .input-group-text {
                border-bottom-color: @color-dark-input-border;
            }

            .input-group-text {
                border-left-color: @color-dark-input-border;
            }

            &.is-invalid {
                & > .content {
                    border-color: @color-dark-input-border-invalid;
                    &.focused {
                        border-color: @color-dark-input-border-invalid;
                        box-shadow: 0 0 0 .2rem @color-dark-input-border-invalid-shadow;
                    }
                }
            }
        }

        .file-upload {
            border-color: @color-dark-table-border;

           .hint {
                color: @color-dark-form-hint;
            }

            &.droptarget {
                &.active {
                    border-color: darken(@color-dark-toolbar-button-background-hover, 20%);
                }

                &.hover {
                    border-color: darken(@color-dark-toolbar-button-background-hover, 20%);
                    background-color: @color-dark-toolbar-button-background-hover;
                }
            }
        }

        .recipient-input {
            .recipient {
                border-color: @color-dark-recipient-input-border;
                background-color: @color-dark-recipient-input-background;
            }
        }

        /*** Tagedit widget (from jqueryui plugin) ***/

        .tagedit-list {
            li.tagedit-listelement-old {
                border-color: @color-dark-recipient-input-border;
                background-color: @color-dark-recipient-input-background;
            }
        }

        .skinselection {
            .skinthumbnail {
                border-color: @color-dark-input-border;
                background: #fff;
            }
        }

        .image-upload {
            background-color: @color-dark-image-upload-background;
        }

        // Remove outline on selects in Firefox
        @-moz-document url-prefix() {
            select:-moz-focusring {
               text-shadow: 0 0 0 @color-dark-font !important;
            }
        }

        .form-control {
            color: @color-dark-font;

            &:focus {
                color: @color-dark-font;
                border-color: @color-dark-input-border-focus;
                box-shadow: 0 0 0 .2rem @color-dark-input-border-focus-shadow;
            }

            // FIXME: This fixes style of required inputs in Firefox/Edge, but
            // makes inputs on login form red-bordered, commented for now
            // &:invalid,
            &.is-invalid {
                border-color: @color-dark-input-border-invalid;

                &:focus {
                    border-color: @color-dark-input-border-invalid;
                    box-shadow: 0 0 0 .2rem @color-dark-input-border-invalid-shadow;
                }
            }

            &::placeholder {
                color: @color-dark-input-placeholder;
            }
        }

        .invalid-feedback {
            color: @color-dark-error;
        }

        .input-group-text {
            color: @color-dark-input;
            background-color: @color-dark-input-addon-background;

            input:focus {
                border-color: @color-dark-input-border-focus !important;
            }
        }

        .custom-switch {
            .custom-control-input {
                & ~ .custom-control-label::before {
                    border-color: @color-dark-checkbox;
                    background-color: @color-dark-checkbox;
                }

                &:focus ~ .custom-control-label:before {
                    box-shadow: 0 0 0 .2rem @color-dark-checkbox-focus-shadow;
                }

                &:focus:not(:checked) ~ .custom-control-label::before {
                    border-color: @color-dark-checkbox-focus;
                }

                &:checked ~ .custom-control-label::before {
                    border-color: @color-dark-checkbox-checked;
                    background-color: @color-dark-checkbox-checked;
                }

                &:checked:disabled ~ .custom-control-label::before {
                    border-color: @color-dark-checkbox-checked-disabled;
                    background-color: @color-dark-checkbox-checked-disabled;
                }
            }
        }

        .custom-file-input:focus ~ .custom-file-label {
            border-color: @color-dark-input-border-focus;
            box-shadow: 0 0 0 .2rem @color-dark-input-border-focus-shadow;
        }

        .mce-tinymce {
            &.mce-container.mce-panel {
                border-color: @color-dark-input-border;
            }

            .mce-btn,
            .mce-panel {
                background-color: @color-dark-input-addon-background;
            }

            .mce-panel {
                border-color: @color-dark-input-border;
            }
        }

        .mce-btn {
            &.mce-active {
                background: @color-dark-btn-secondary-background !important;
            }
        }

        .mce-window {
            .mce-reset {
                background: #fff;
            }

            .mce-window-head {
                border-bottom-color: @color-dark-dialog-header-border;

                .mce-title {
                    color: @color-dark-dialog-header;
                }

                .mce-close {
                    color: @color-dark-dialog-header;
                }
            }

            .mce-foot {
                @media screen and (max-width: @screen-width-xs) {
                    border-top-color: @color-dark-dialog-header-border;
                }

                .mce-btn {
                    &:focus {
                        color: @color-dark-btn-secondary;
                        background: @color-dark-btn-secondary-background;
                    }

                    button:hover,
                    button {
                        color: @color-dark-btn-secondary;
                    }
                }
            }

            .mce-textbox {
                color: @color-dark-font;

                &:focus {
                    color: @color-dark-font;
                    border-color: @color-dark-input-border-focus;
                    box-shadow: 0 0 0 .2rem @color-dark-input-border-focus-shadow;
                }
            }

            .mce-listbox {
                &:focus {
                    border-color: @color-dark-input-border-focus !important;
                    box-shadow: 0 0 0 .2rem @color-dark-input-border-focus-shadow !important;
                }
            }

            .mce-checkbox {
                i.mce-i-checkbox {
                    color: @color-dark-checkbox;
                }
            }

            .mce-combobox {
                .mce-btn {
                    background: @color-dark-input-addon-background;

                    &:focus {
                        background-color: @color-dark-input-border-focus-shadow;
                        border-color: #c5c5c5;
                    }
                }
            }

            .mce-tabs {
                border-color: @color-dark-layout-border;

                .mce-tab {
                    color: @color-dark-link;

                    &.mce-active {
                        border-color: @color-dark-layout-border;
                        border-bottom-color: #fff;
                        color: @color-dark-font !important;
                    }

                    &:not(.mce-active):hover {
                        border-color: @color-dark-list-border;
                    }
                }
            }

            .mce-label {
                color: @color-dark-font;
            }
        }


        // Menus and popovers, e.g. color selector, emoticons selector, font selector
        .mce-menu,
        .mce-floatpanel.mce-popover {
            box-shadow: 3px 3px 5px @color-dark-popover-shadow !important;
            border-color: @color-dark-layout-border !important;
        }

        .mce-menu {
            .mce-menu-item.mce-active {
                color: @color-dark-toolbarmenu-hover;
                background-color: @color-dark-toolbarmenu-hover-background;
            }
        }

        #mce-modal-block.mce-in {
            background-color: @color-dark-dialog-overlay-background;
        }

        @media screen and (max-width: @screen-width-xs) {
            .mce-window {
                .mce-window-head {
                    background-color: @color-dark-layout-mobile-header-background;
                }

                .mce-foot {
                    background-color: @color-dark-layout-mobile-footer-background;

                    .mce-container-body {
                        .mce-btn {
                            button {
                                color: @color-dark-font;
                            }
                        }
                    }
                }
            }

            .mce-menu {
                .mce-menu-item {
                    border-bottom-color: @color-dark-list-border;

                    .mce-text {
                        color: @color-dark-font;
                    }

                    &.mce-menu-item-preview {
                        &.mce-active {
                            &:after {
                                color: @color-dark-font;
                            }
                        }
                    }

                    &.mce-menu-item-expand {
                        &:after {
                            color: @color-dark-font;
                        }
                    }
                }
            }

            .mce-charmap {
                td {
                    border-bottom-color: @color-dark-list-border !important;
                }
            }
        }

        .image-selector {
            &.droptarget {
                border-color: @color-dark-table-border;
            }

            .attachmentslist {
                li {
                    &:hover,
                    &:focus {
                        background: @color-dark-list-selected-background;
                    }

                    span.img {
                        border-color: @color-dark-list-border;
                    }
                }
            }
        }


        /*** HTML editor widget ***/

        .html-editor {
            & > .nav {
                a.active {
                    border-color: @color-dark-input-border !important;

                    &.mode-html {
                        background-color: @color-dark-input-addon-background;
                        border-bottom-color: @color-dark-input-addon-background !important;
                    }

                    &.mode-plain {
                        border-bottom-color: #fff !important;
                    }
                }
            }

            & > iframe { // e.g. mailvelope frame
                border-color: @color-dark-input-border;
            }

            & > .mce-tinymce.focused {
                border-color: @color-dark-input-border-focus;
                box-shadow: 0 0 0 .2rem @color-dark-input-border-focus-shadow !important;
            }
        }

        .googie_edit_layer {
            border-color: @color-dark-input-border;
        }

        .googie_link {
            color: @color-dark-spellcheck-link;
        }

        .googie_list {
            td {
                &.googie_list_onhover {
                    color: @color-dark-toolbarmenu-hover;
                    background-color: @color-dark-toolbarmenu-hover-background;
                }
            }
        }

        #message-header {
            .subject {
                body.status-flagged &:before {
                    color: @color-dark-error;
                }
            }
        }

        .message-part,
        .message-htmlpart {
            &:not(:first-child) {
                border-top-color: lighten(@color-dark-mail-headers, 50%);
            }

            blockquote {
                color: @color-dark-blockquote-0;
                border-left-color: @color-dark-blockquote-0-border;
                border-right-color: @color-dark-blockquote-0-border;
                background-color: @color-dark-blockquote-background;

                blockquote {
                    color: @color-dark-blockquote-1;
                    border-left-color: @color-dark-blockquote-1-border;
                    border-right-color: @color-dark-blockquote-1-border;

                    blockquote {
                        color: @color-dark-blockquote-2;
                        border-left-color: @color-dark-blockquote-2-border;
                        border-right-color: @color-dark-blockquote-2-border;
                    }
                }

                span.blockquote-link {
                    color: @color-dark-black-shade-text;
                    background: @color-dark-black-shade-bg;
                    border-color: @color-dark-black-shade-border;
                }
            }
        }

        .message-part {
            span.sig {
                color: @color-dark-mail-signature;
            }
        }

        .message-partheaders {
            border-top-color: @color-dark-list-border;
            border-bottom-color: @color-dark-list-border;
            color: @color-dark-mail-headers;
        }

        .image-tools {
            background-color: @color-dark-image-tools-background;

            a {
                color: @color-dark-image-tools;

                &:focus,
                &:hover {
                    background-color: @color-dark-image-tools-hover !important;
                }
            }
        }

        #login-footer {
            color: @color-dark-black-shade-text;

            & > div {
                background: @color-dark-black-shade-bg;
            }
        }

        #contacthead {
            &.readonly {
                .source.row {
                    color: @color-dark-form-hint;
                }
            }
        }
    }
}
