/**
 * Roundcube webmail styles for the Elastic skin
 *
 * Copyright (c) 2017-2018, The Roundcube Dev Team
 *
 * The contents are subject to the Creative Commons Attribution-ShareAlike
 * License. It is allowed to copy, distribute, transmit and to adapt the work
 * by keeping credits to the original authors in the README.md file.
 * See http://creativecommons.org/licenses/by-sa/3.0/ for details.
 */

& when (@dark-mode-enabled = true) {
    @media (prefers-color-scheme: dark) {
        body {
            color: @color-dark-font;
            background-color: @color-dark-layout-content-background;
        }

        .form-control {
            background-color: @color-dark-input-background;

            &:focus {
                background-color: @color-dark-input-background-focus;
            }
        }

        .popover {
            background-color: @color-dark-popover-background;
        }

        .popover-body {
            color: @color-dark-font;
        }

        .bs-popover-auto[x-placement^="right"] > .arrow::after,
        .bs-popover-right > .arrow::after {
            border-right-color: @color-dark-popover-background;
        }

        .bs-popover-auto[x-placement^="left"] > .arrow::after,
        .bs-popover-left > .arrow::after {
            border-left-color: @color-dark-popover-background;
        }

        .bs-popover-auto[x-placement^="top"] > .arrow::after,
        .bs-popover-top > .arrow::after {
            border-top-color: @color-dark-popover-background;
        }

        .bs-popover-auto[x-placement^="bottom"] > .arrow::after,
        .bs-popover-bottom > .arrow::after {
            border-bottom-color: @color-dark-popover-background;
        }

        .ui-widget-header {
            background-color: @color-dark-dialog-header-background !important;
        }

        .ui-widget-content {
            background-color: @color-dark-dialog-content-background !important;
        }

        .nav-tabs .nav-item.show .nav-link,
        .nav-tabs .nav-link.active {
            color: @color-dark-font;
            background: @color-dark-layout-header-background;
            bordeer-color: @color-dark-layout-border;
        }

        .form-control-plaintext {
            color: @color-dark-font;
        }

        .table {
            color: @color-dark-font;
        }

        body > #layout {
            & > div {
                &.sidebar,
                &.list {
                    border-right-color: @color-dark-layout-border;
                }

                &.content {
                    background-color: @color-dark-layout-content-background;
                }

                &.sidebar {
                    background-color: @color-dark-layout-sidebar-background;
                }

                &.list {
                    background-color: @color-dark-layout-list-background;
                }

                & > .header,
                & > .footer {
                    background-color: @color-dark-layout-header-background;
                }

                & > .header {
                    border-bottom-color: @color-dark-layout-border;
                    color: @color-dark-layout-header;
                }

                & > .footer {
                    border-top-color: @color-dark-layout-border;
                    background-color: @color-dark-layout-footer-background;
                }
            }
        }

        @media screen and (max-width: @screen-width-small) {
            body > #layout > div > .header {
                background-color: @color-dark-layout-mobile-header-background;
            }

            body > #layout > div > .footer {
                background-color: @color-dark-layout-mobile-footer-background;
            }
        }

        @media screen and (min-width: (@screen-width-xs + 1px)) {
            body > #layout > .menu {
                // FIXME: we set background color here not in taskmenu.less, because
                // otherwise background is partially white on Android/iOS
                background-color: @color-dark-taskmenu-background;
            }
        }

        .listbox {
            .popup & {
                .footer {
                    border-top-color: @color-dark-layout-border;
                    background-color: @color-dark-searchbar-background;
                }
            }
        }

        // this is when image thumbnails are enabled
        p.image-attachment {
            border-color: @color-dark-border;

            span {
                color: @color-dark-form-hint;
            }
        }

        // this is when image thumbnails are disabled
        fieldset.image-attachment {
            legend {
                color: @color-dark-form-hint;
                border-top-color: lighten(@color-dark-mail-headers, 50%);
            }
        }

        .iframe-loader {
            .spinner-border {
                color: @color-dark-spinner-circle;
                border-color: currentColor @color-dark-spinner-item currentColor currentColor;
            }
        }

        .webkit-scroller {
            &::-webkit-scrollbar-thumb {
                border-color: #fff;
            }
        }

        .quota-widget {
            color: @color-dark-quota-text;

            .count {
                color: @color-dark-quota-text;
            }

            .bar {
                border-color: @color-dark-layout-border;
            }
        }

        .quota-info {
            .root {
                color: @color-dark-popover-separator;
                background-color: @color-dark-popover-separator-background;
            }
        }

        .table-widget {
            border-color: @color-dark-table-border;

            & > .footer {
                border-top-color: @color-dark-table-border;
            }

            // Options table is a table with first column for identifier/description
            // and other columns for a state flag. E.g. ACL table
            table.options-table {
                tr:last-child td {
                    border-bottom-color: @color-dark-table-border;
                }

                tr.selected td {
                    background-color: @color-dark-table-selected-background;
                    color: @color-dark-table-selected;
                }
            }
        }

        /*** Bootstrap button style overrides ***/

        .btn-secondary {
            background: @color-dark-btn-secondary-background;
            border-color: @color-dark-btn-secondary-background;

            &:focus {
                box-shadow: 0 0 0 .2rem fade(@color-dark-btn-secondary-background, 50%);
            }

            &:hover {
                background: darken(@color-dark-btn-secondary-background, 5%);
                border-color: darken(@color-dark-btn-secondary-background, 7%);
            }

            &.disabled,
            &:disabled {
                background: lighten(@color-dark-btn-secondary-background, 20%);
                border-color: lighten(@color-dark-btn-secondary-background, 20%);
                opacity: 1;
            }

            &:not(:disabled):not(.disabled) {
                &:active,
                &.active {
                    background: darken(@color-dark-btn-secondary-background, 10%);
                    border-color: darken(@color-dark-btn-secondary-background, 12%);

                    &:focus {
                        box-shadow: 0 0 0 .2rem fade(@color-dark-btn-secondary-background, 53%);
                    }
                }
            }
        }

        /*** jQuery-UI widgets' style overrides ***/

        .ui-widget-overlay {
            background-color: @color-dark-dialog-overlay-background;
        }

        .ui-widget {
            border-color: @color-dark-datepicker-border;
            box-shadow: 3px 3px 5px @color-dark-popover-shadow;
        }

        .ui-dialog {
            .ui-dialog-titlebar {
                border-bottom-color: @color-dark-dialog-header-border;
            }

            .ui-dialog-title {
                color: @color-dark-dialog-header;
            }

            .ui-dialog-titlebar-close {
                color: @color-dark-dialog-header;
            }

            .ui-dialog-buttonpane {
                .ui-dialog-buttonset {
                    a.btn-link {
                        color: @color-dark-font;
                    }
                }
            }
        }

        @media screen and (max-width: @screen-width-xs) {
            .ui-dialog {
                .ui-dialog-titlebar {
                    background-color: @color-dark-layout-mobile-header-background;
                }

                .ui-dialog-buttonpane {
                    border-top-color: @color-dark-dialog-header-border;
                    background-color: @color-dark-layout-mobile-footer-background;

                    .ui-dialog-buttonset {
                        button {
                            &.btn-primary,
                            &.btn-secondary {
                                color: @color-dark-toolbar-button;
                            }
                        }

                        a.btn-link {
                            color: @color-dark-toolbar-button;
                        }
                    }
                }
            }
        }

        /* Datepicker widget */

        .ui-datepicker {
            .ui-datepicker-header {
                border-bottom-color: @color-dark-dialog-header-border;
            }

            .ui-state-default,
            &.ui-widget-content .ui-state-default {
                color: @color-dark-datepicker-font;
            }
        }

        .minicolors-panel {
            border-color: @color-dark-datepicker-border;
            box-shadow: 3px 3px 5px @color-dark-popover-shadow;
        }

        .popover {
            box-shadow: 3px 3px 5px @color-dark-popover-shadow;
            border-color: @color-dark-layout-border;
        }

        html.layout-small,
        html.layout-phone {
            .popover:not(.select-menu) {
                .listing li:last-child {
                    border-bottom-color: @color-dark-list-border;
                }
            }

            .popover-overlay {
                background-color: @color-dark-dialog-overlay-background;
            }
        }

        /** PGP Key search/import dialog **/

        .pgpkeyimport {
            div.key {
                &.revoked,
                &.disabled {
                    color: @color-dark-list-secondary;
                }
            }
        }

        #taskmenu {
            @media screen and (max-width: @screen-width-xs) {
                a {
                    border-bottom-color: @color-dark-list-border;
                    color: @color-dark-list;
                }
            }

            @media screen and (min-width: (@screen-width-xs + 1px)) {
                a {
                    &.selected {
                        background: @color-dark-taskmenu-button-selected-background;
                    }

                    &:hover {
                        background: @color-dark-taskmenu-button-background-hover;
                    }
                }

                .special-buttons {
                    background-color: @color-dark-taskmenu-background;
                }

                .action-buttons {
                    a {
                        &:hover {
                            background: @color-dark-taskmenu-button-action-background-hover;
                        }

                        &.selected {
                            background: @color-dark-taskmenu-button-selected-background;
                        }
                    }
                }
            }
        }

        .menu {
            .popover-header {
                @media screen and (min-width: (@screen-width-xs + 1px)) {
                    background-color: @color-dark-taskmenu-background !important;
                }
            }
        }

        .ui.alert {
            color: @color-dark-message;

            & > i.icon {
                color: lighten(@color-dark-black, 25%);
            }

            &.loading {
                color: @color-dark-message-loading;
            }

            &.boxerror {
                & when not(@color-dark-message-error-box = @color-dark-message) { color: @color-dark-message-error-box; }
            }

            &.boxinformation {
                & when not(@color-dark-message-information-box = @color-dark-message) { color: @color-dark-message-information-box; }
            }

            &.boxconfirmation {
                & when not(@color-dark-message-error-box = @color-dark-message) { color: @color-dark-message-error-box; }
            }

            &.boxwarning {
                & when not(@color-dark-message-warning-box = @color-dark-message) { color: @color-dark-message-warning-box; }
            }
        }

        #messagestack {
            div {
                background-color: @color-dark-message;
                color: #fff;

                & > i.icon:before {
                    color: #fff;
                }
            }

            .loading {
                background-color: @color-dark-message-loading;
            }
        }

        .toolbar {
            &.listing a,
            a {
                color: @color-dark-toolbar-button;
            }

            &.pagenav {
                .pagenav-text {
                    color: @color-dark-list-pagenav;
                }

                &.pagenav-list {
                    background-color: @color-dark-searchbar-background;
                    border-bottom-color: @color-dark-list-border;

                    & + .navlist {
                        background-color: #fbfbfb;
                    }

                    &.expanded + .navlist {
                        border-bottom-color: @color-dark-layout-border;
                    }
                }
            }
        }


        .header {
            a.button {
                color: @color-dark-toolbar-button;
            }

            .buttons {
                button {
                    color: @color-dark-toolbar-button;
                }
            }
        }

        .toolbarmenu li {
            &.separator {
                color: @color-dark-popover-separator;
                background-color: @color-dark-popover-separator-background;
            }
        }

        @media screen and (min-width: (@screen-width-small + 1px)) {
            .toolbar {

                a.button {
                    &:not(.disabled):focus,
                    &:not(.disabled):hover {
                        background-color: @color-dark-toolbar-button-background-hover;
                    }
                }

                .dropbutton {
                    &:not(.disabled):hover {
                        background-color: @color-dark-toolbar-button-background-hover;
                    }

                    a.button.dropdown {
                        &:hover {
                            background-color: darken(@color-dark-toolbar-button-background-hover, 5%);
                        }
                    }
                }
            }

            .header a.button.icon {
                &:not(.disabled):focus,
                &:not(.disabled):hover {
                    background-color: @color-dark-toolbar-button-background-hover;
                }
            }
        }

        @media screen and (max-width: @screen-width-small) {
            .toolbar.listing a {
                color: @color-dark-font;
            }
        }

        .searchbar {
            background-color: @color-dark-searchbar-background;
            border-bottom-color: @color-dark-list-border;

            form {
                &:before {
                    color: @color-dark-list-pagenav;
                }

                input {
                    color: @color-dark-searchbar;
                }
            }

            a.button {
                color: @color-dark-toolbar-button;
            }
        }

        .listing {
            tbody td,
            li {
                border-bottom-color: @color-dark-list-border;
            }

            tbody td,
            li a {
                color: @color-dark-list;
            }

            tbody td {
                a {
                    color: @color-dark-list;
                }
            }

            li.selected,
            tr.selected td {
                color: @color-dark-list-selected;
                background-color: @color-dark-list-selected-background;
            }

            li.disabled,
            tr.disabled td {
                color: @color-dark-list-deleted;
            }

            span.secondary {
                color: @color-dark-list-secondary;
            }
        }

        ul.listing {
            li {
                ul {
                    border-top-color: @color-dark-list-border;
                }
            }
        }

        .listing-info {
            color: @color-dark-list-secondary;
        }

        @media screen and (max-width: @screen-width-large) {
            .listing.selection-large-only {
                li.selected {
                    color: @color-dark-list;
                }
            }
        }

        ul.treelist {
            li {
                &.selected {
                    & > div > a, // this is used e.g. by kolab_addressbook
                    & > a {
                        color: @color-dark-list-selected;
                        background-color: @color-dark-list-selected-background;
                    }
                }
            }
        }

        .messagelist {
            tr.unread td.subject span.subject a {
                color: @color-dark-list-unread;
            }

            td.subject {
                span {
                    &.date {
                        color: @color-dark-list-secondary;
                    }

                    &.fromto {
                        color: @color-dark-list-secondary;
                    }
                }
            }

            tr.deleted td,
            tr.deleted td.subject span.subject a,
            tr.deleted td.subject span.date,
            tr.deleted td.subject span.fromto {
                color: @color-dark-list-deleted;
            }

            span.attachment span {
                color: @color-dark-list-icon;
            }
        }

        .contactlist {
            span.email {
                color: @color-dark-list-secondary;
            }
        }

        .attachmentslist {
            li {
                .attachment-name {
                    color: @color-dark-font;
                }

                .attachment-size {
                    color: @color-dark-list-secondary;
                }
            }
        }

        .propform {
            .form-text {
                color: @color-dark-form-hint;
            }
        }

        .formcontent {
            .hint {
                color: @color-dark-form-hint;
            }

            // RAW (CodeMirror) editor
            &.raweditor {
                .CodeMirror {
                    color: @color-dark-font;
                }
            }
        }

        .file-upload {
            border-color: @color-dark-table-border;

           .hint {
                color: @color-dark-form-hint;
            }

            &.droptarget {
                &.active {
                    border-color: darken(@color-dark-toolbar-button-background-hover, 20%);
                }

                &.hover {
                    border-color: darken(@color-dark-toolbar-button-background-hover, 20%);
                    background-color: @color-dark-toolbar-button-background-hover;
                }
            }
        }

        .recipient-input {
            input {
                color: @color-dark-font;
            }

            .recipient {
                background-color: @color-dark-recipient-input-background;
            }
        }

        /*** Tagedit widget (from jqueryui plugin) ***/

        .tagedit-list {
            li.tagedit-listelement-old {
                background-color: @color-dark-recipient-input-background;
            }
        }

        .image-upload {
            background-color: @color-dark-image-upload-background;
        }

        // Remove outline on selects in Firefox
        @-moz-document url-prefix() {
            select:-moz-focusring {
               text-shadow: 0 0 0 @color-dark-font !important;
            }
        }

        .form-control {
            color: @color-dark-font;

            &:focus {
                color: @color-dark-font;
            }
        }

        .input-group-text {
            color: @color-dark-input;
            background-color: @color-dark-input-addon-background;
        }

        .custom-switch {
            .custom-control-input {
                & ~ .custom-control-label::before {
                    border-color: @color-dark-checkbox;
                    background-color: @color-dark-checkbox;
                }
            }
        }

        .mce-tinymce {
            .mce-btn,
            .mce-panel {
                background-color: @color-dark-layout-header-background;
            }
        }

        .mce-btn {
            &.mce-active {
                background: @color-dark-btn-secondary-background !important;
            }
        }

        .mce-ico,
        .mce-menubtn button {
            color: @color-dark-font !important;
        }

        .mce-window {
            .mce-reset {
                background: @color-dark-layout-content-background;
            }

            .mce-window-head {
                border-bottom-color: @color-dark-dialog-header-border;

                .mce-title {
                    color: @color-dark-dialog-header;
                }

                .mce-close {
                    color: @color-dark-dialog-header;
                }
            }

            .mce-foot {
                @media screen and (max-width: @screen-width-xs) {
                    border-top-color: @color-dark-dialog-header-border;
                }

                .mce-btn {
                    &:focus {
                        background: @color-dark-btn-secondary-background;
                    }
                }
            }

            .mce-textbox {
                color: @color-dark-font;

                &:focus {
                    color: @color-dark-font;
                }
            }

            .mce-checkbox {
                i.mce-i-checkbox {
                    color: @color-dark-checkbox;
                }
            }

            .mce-combobox {
                .mce-btn {
                    background: @color-dark-input-addon-background;
                }
            }

            .mce-tabs {
                border-color: @color-dark-layout-border;

                .mce-tab {
                    &.mce-active {
                        border-color: @color-dark-layout-border;
                        border-bottom-color: #fff;
                        color: @color-dark-font !important;
                    }

                    &:not(.mce-active):hover {
                        border-color: @color-dark-list-border;
                    }
                }
            }

            .mce-label {
                color: @color-dark-font;
            }
        }


        // Menus and popovers, e.g. color selector, emoticons selector, font selector
        .mce-menu,
        .mce-floatpanel.mce-popover {
            box-shadow: 3px 3px 5px @color-dark-popover-shadow !important;
            border-color: @color-dark-layout-border !important;
        }

        #mce-modal-block.mce-in {
            background-color: @color-dark-dialog-overlay-background;
        }

        @media screen and (max-width: @screen-width-xs) {
            .mce-window {
                .mce-window-head {
                    background-color: @color-dark-layout-mobile-header-background;
                }

                .mce-foot {
                    background-color: @color-dark-layout-mobile-footer-background;

                    .mce-container-body {
                        .mce-btn {
                            button {
                                color: @color-dark-font;
                            }
                        }
                    }
                }
            }

            .mce-menu {
                .mce-menu-item {
                    border-bottom-color: @color-dark-list-border;

                    .mce-text {
                        color: @color-dark-font;
                    }

                    &.mce-menu-item-preview {
                        &.mce-active {
                            &:after {
                                color: @color-dark-font;
                            }
                        }
                    }

                    &.mce-menu-item-expand {
                        &:after {
                            color: @color-dark-font;
                        }
                    }
                }
            }

            .mce-charmap {
                td {
                    border-bottom-color: @color-dark-list-border !important;
                }
            }
        }

        .image-selector {
            &.droptarget {
                border-color: @color-dark-table-border;
            }

            .attachmentslist {
                li {
                    &:hover,
                    &:focus {
                        background: @color-dark-list-selected-background;
                    }

                    span.img {
                        border-color: @color-dark-list-border;
                    }
                }
            }
        }


        /*** HTML editor widget ***/

        .html-editor {
            & > .nav {
                a.active {
                    &.mode-html {
                        background-color: @color-dark-layout-header-background;
                        border-bottom-color: @color-dark-input-addon-background !important;
                    }

                    &.mode-plain {
                        border-bottom-color: #fff !important;
                    }
                }
            }
        }

        .message-part,
        .message-htmlpart {
            &:not(:first-child) {
                border-top-color: lighten(@color-dark-mail-headers, 50%);
            }

            blockquote {
                background-color: @color-dark-blockquote-background;

                span.blockquote-link {
                    color: @color-dark-black-shade-text;
                    background: @color-dark-black-shade-bg;
                    border-color: @color-dark-black-shade-border;
                }
            }
        }

        .message-part {
            span.sig {
                color: @color-dark-mail-signature;
            }
        }

        .message-partheaders {
            border-top-color: @color-dark-list-border;
            border-bottom-color: @color-dark-list-border;
            color: @color-dark-mail-headers;
        }

        #login-footer {
            color: @color-dark-black-shade-text;

            & > div {
                background: @color-dark-black-shade-bg;
            }
        }

        #contacthead {
            &.readonly {
                .source.row {
                    color: @color-dark-form-hint;
                }
            }
        }
    }
}
